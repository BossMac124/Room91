<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>íˆ¬ë£¸ ë§¤ë¬¼ ì§€ë„</title>
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c0621bc4a0f59aff38dbd93a18f3ec6f&libraries=services,clusterer"></script>
    <style>
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: sans-serif }
        nav {
            background: #007aff; color: white; padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        nav button {
            border: none; border-radius: 4px; padding: 6px 12px; font-size: 14px; cursor: pointer;
        }
        nav button.active {
            background: #005fcc; color: white;
        }
        nav button.inactive {
            background: white; color: #007aff;
        }
        #mainLayout { display: flex; flex: 1; }
        #houseList { width: 300px; border-right: 1px solid #ccc; padding: 10px; background: #fafafa; overflow-y: auto }
        #directionBtn { width: 100%; padding: 8px; margin-bottom: 10px; border: none; border-radius: 4px; background: #007aff; color: #fff; font-size: 16px; cursor: pointer }
        #directionResult { border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-bottom: 10px; background: #fff }
        #houseListContent .house-item { padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; background: #fff; cursor: pointer }
        #houseListContent .house-item:hover { background: #f0f0f0 }
        .house-title { font-weight: bold; margin-bottom: 5px }
        .house-info { font-size: 14px; color: #666 }
        #houseDetail { width: 400px; border-right: 1px solid #ccc; padding: 10px; background: #fff; display: none; overflow-y: auto }
        #detailHeader { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px }
        #detailHeader h3 { margin: 0; font-size: 18px }
        #closeDetailBtn { background: none; border: none; font-size: 18px; cursor: pointer; color: #999 }
        #closeDetailBtn:hover { color: #333 }
        .detail-row { margin-bottom: 6px }
        .detail-label { font-weight: bold; margin-right: 5px }
        #mapWrapper { flex: 1; position: relative }
        #map { width: 100%; height: 100% }
        #searchForm { position: absolute; top: 10px; left: 10px; z-index: 2; background: #fff; padding: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,.3) }

        /* ë§í’ì„  ì»¨í…Œì´ë„ˆ */
        .dest-bubble {
            display: inline-block;
            position: relative;
            padding: 6px 12px;
            background: #FF746C;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            border-radius: 12px;
            white-space: nowrap;
        }

        /* ë§í’ì„  ì•„ë˜ ì‚¼ê°í˜•(ê¼¬ë¦¬) */
        .dest-bubble::after {
            content: "";
            position: absolute;
            bottom: -6px;                /* ë§í’ì„  ì•„ë˜ì— ë°°ì¹˜ */
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px 6px 0 6px; /* ìœ„ìª½ì´ ì‚¼ê°í˜• */
            border-style: solid;
            border-color: #FF746C transparent transparent transparent;
        }
    </style>
</head>
<body>

<!-- âœ… ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav>
    <div style="font-size: 18px; font-weight: bold;">ğŸ  ë¶€ë™ì‚° ë§¤ë¬¼ ì§€ë„</div>
    <div>
        <button class="inactive" onclick="window.location.href='/'">ì›ë£¸</button>
        <button class="active" disabled>íˆ¬ë£¸</button>
    </div>
</nav>

<!-- âœ… ë©”ì¸ ë ˆì´ì•„ì›ƒ -->
<div id="mainLayout">
    <!-- ë§¤ë¬¼ ëª©ë¡ -->
    <div id="houseList">
        <button id="directionBtn">ê¸¸ì°¾ê¸°</button>
        <div id="directionResult">ì—¬ê¸°ì— ê¸¸ì°¾ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
        <div id="houseListContent"><p>íˆ¬ë£¸ ë§¤ë¬¼ ëª©ë¡ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</p></div>
    </div>

    <!-- ë§¤ë¬¼ ìƒì„¸ -->
    <div id="houseDetail">
        <div id="detailHeader"><h3>ë§¤ë¬¼ ìƒì„¸ ì •ë³´</h3><button id="closeDetailBtn">X</button></div>
        <div id="detailContent"><p>ë§¤ë¬¼ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p></div>
    </div>

    <!-- ì§€ë„ -->
    <div id="mapWrapper">
        <div id="searchForm">
            <div style="margin-bottom:5px">
                <label><input type="checkbox" name="tradeType" value="B1" checked> ì „ì„¸</label>
                <label><input type="checkbox" name="tradeType" value="B2" checked> ì›”ì„¸</label>
                <label><input type="checkbox" name="tradeType" value="B3" checked> ë‹¨ê¸°ì„ëŒ€</label>
            </div>
            <div style="margin-bottom:5px">
                <label><b>ì›”ì„¸ ë²”ìœ„ (ë§Œì›)</b></label><br/>
                <input id="rentPrcMin" type="number" placeholder="ìµœì†Œ" style="width:60px"/> ~
                <input id="rentPrcMax" type="number" placeholder="ìµœëŒ€" style="width:60px"/>
            </div>
            <div style="margin-bottom:5px">
                <label><b>ë³´ì¦ê¸ˆ ë²”ìœ„ (ë§Œì›)</b></label><br/>
                <input id="dealPrcMin" type="number" placeholder="ìµœì†Œ" style="width:60px"/> ~
                <input id="dealPrcMax" type="number" placeholder="ìµœëŒ€" style="width:60px"/>
            </div>
            <input id="addressInput" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width:200px"/>
            <button id="searchButton">ê²€ìƒ‰</button>
        </div>
        <div id="map"></div>
    </div>
</div>

<script>
    // ì „ì—­ë³€ìˆ˜
    let searchedLat = null, searchedLng = null;
    let destLat = null, destLng = null; // ëª©ì ì§€ ì¢Œí‘œ ì €ì¥ ë³€ìˆ˜
    let addressMarker = null, companyLabel = null;
    let straightLine = null;   // ì¶œë°œ â†” ë„ì°©ì„ ì‡ëŠ” ì§ì„ (ì ì„ )
    let routeLine    = null;   // ì‹¤ì œ ë„ë¡œ ê²½ë¡œì„ (ì‹¤ì„ )
    let destMarker   = null;   // ë„ì°©ì§€ ë§í’ì„ 

    // â”€â”€â”€ ì§€ë„ ì´ˆê¸°í™” â”€â”€â”€
    const map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.5665, 126.9780), level: 5
    });

    const pastelStyles = [
        {
            width: '40px',
            height: '40px',
            background: 'rgba(191, 239, 255, 0.7)',  // #BFEFFF â†’ rgba(191,239,255,0.7)
            color: '#333',
            textAlign: 'center',
            lineHeight: '40px',
            borderRadius: '50%',
            boxShadow: '0 2px 6px rgba(0,0,0,0.2)',
            fontWeight: 'bold'
        },
        {
            width: '50px',
            height: '50px',
            background: 'rgba(182, 252, 213, 0.7)',  // #B6FCD5
            color: '#333',
            textAlign: 'center',
            lineHeight: '50px',
            borderRadius: '50%',
            boxShadow: '0 2px 6px rgba(0,0,0,0.2)',
            fontWeight: 'bold'
        },
        {
            width: '60px',
            height: '60px',
            background: 'rgba(255, 209, 179, 0.7)',  // #FFD1B3
            color: '#333',
            textAlign: 'center',
            lineHeight: '60px',
            borderRadius: '50%',
            boxShadow: '0 2px 6px rgba(0,0,0,0.2)',
            fontWeight: 'bold'
        },
        {
            width: '70px',
            height: '70px',
            background: 'rgba(195, 177, 225, 0.7)',  // #C3B1E1
            color: '#fff',
            textAlign: 'center',
            lineHeight: '70px',
            borderRadius: '50%',
            boxShadow: '0 2px 6px rgba(0,0,0,0.2)',
            fontWeight: 'bold'
        }
    ];
    // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ ë°©ì‹ì˜ í´ëŸ¬ìŠ¤í„°ëŸ¬
    const clusterer = new kakao.maps.MarkerClusterer({
        map,
        averageCenter: true,
        minLevel: 2,
        minClusterSize: 1,
        disableClickZoom: true,
        styles: pastelStyles
    });

    // â”€â”€â”€ ì„œë¹„ìŠ¤ ê°ì²´ â”€â”€â”€
    const ps = new kakao.maps.services.Places();
    const geocoder = new kakao.maps.services.Geocoder();
    const input = document.getElementById('addressInput');

    // â”€â”€â”€ decodePolyline í•¨ìˆ˜ â”€â”€â”€
    function decodePolyline(encoded) {
        const path = [];
        let index = 0, lat = 0, lng = 0;
        while (index < encoded.length) {
            let b, shift = 0, result = 0;
            do {
                b = encoded.charCodeAt(index++) - 63;
                result |= (b & 0x1f) << shift;
                shift += 5;
                } while (b >= 0x20);
            lat += (result & 1) ? ~(result >> 1) : (result >> 1);

                shift = 0; result = 0;
            do {
                b = encoded.charCodeAt(index++) - 63;
                result |= (b & 0x1f) << shift;
                shift += 5;
            } while (b >= 0x20);
            lng += (result & 1) ? ~(result >> 1) : (result >> 1);

            path.push(new kakao.maps.LatLng(lat * 1e-5, lng * 1e-5));
        }
        return path;
    }

    // â”€â”€â”€ ê³µí†µ ê²°ê³¼ ì²˜ë¦¬ â”€â”€â”€
    function handleResult(res, status) {
        if(status!==kakao.maps.services.Status.OK){
            return alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
        const lng = parseFloat(res[0].x), lat = parseFloat(res[0].y);
        setCenterAndSearch(lat, lng);
    }

    function setCenterAndSearch(lat, lng) {
        // ì´ˆê¸°í™”
        if(routeLine){ routeLine.setMap(null); routeLine=null; }
        if(straightLine){ straightLine.setMap(null); straightLine=null; }
        if(destMarker){ destMarker.setMap(null); destMarker=null; }
        document.getElementById('directionResult').innerText = 'ì—¬ê¸°ì— ê¸¸ì°¾ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';

        // ì €ì¥Â·ì´ë™
        searchedLat=lat; searchedLng=lng; destLat=destLng=null;
        map.setCenter(new kakao.maps.LatLng(lat, lng));

        // íšŒì‚¬ ìœ„ì¹˜
        if(addressMarker) addressMarker.setMap(null);
        if(companyLabel ) companyLabel.setMap(null);
        addressMarker = new kakao.maps.Marker({ position:new kakao.maps.LatLng(lat,lng), map });
        companyLabel = new kakao.maps.CustomOverlay({
            position: addressMarker.getPosition(),
            yAnchor: 1.4,
            content: '<div style="padding:4px 8px;background:#0066ff;color:#fff;border-radius:4px;">íšŒì‚¬ ìœ„ì¹˜</div>'
        });
        companyLabel.setMap(map);

        // ë§¤ë¬¼ ì¡°íšŒ
        const types = Array.from(document.querySelectorAll('input[name="tradeType"]:checked')).map(c=>c.value);
        const rMin = parseInt(document.getElementById('rentPrcMin').value)||0;
        const rMax = parseInt(document.getElementById('rentPrcMax').value)||999999999;
        const dMin = parseInt(document.getElementById('dealPrcMin').value)||0;
        const dMax = parseInt(document.getElementById('dealPrcMax').value)||999999999;
        const params = [
            `lng=${lng}`, `lat=${lat}`, `radius=3`,
            ...types.map(t=>`tradeTypeCodes=${t}`),
            `rentPrcMin=${rMin}`, `rentPrcMax=${rMax}`,
            `dealPrcMin=${dMin}`, `dealPrcMax=${dMax}`
        ].join('&');

        const url = `/house/two?${params}`;
        console.log('[request url]', url);

        fetch(url)
            .then(res => {
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return res.json();
            })
            .then(data => {
                console.log('[raw data]', data);
                const list = Array.isArray(data)
                    ? data
                    : data.content || data.data || [];
                console.log('[list length]', list.length);
                return list;
            })
            .then(list => {
                const filtered = list.filter(h =>
                    h.location
                    && Array.isArray(h.location.coordinates)
                    && h.location.coordinates.length === 2
                );
                console.log('[filtered length]', filtered.length);
                return filtered;
            })
            .then(filtered => {
                console.log('[render markers]', filtered);
                renderSearchResult(filtered);
            })
            .catch(e => {
                console.error('[error]', e);
                alert(`ë§¤ë¬¼ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: ${e.message}`);
            });


        // fetch(`/house/two?${params}`)
        //     .then(r=>r.json())
        //     .then(renderSearchResult)
        //     .catch(()=>alert('ë§¤ë¬¼ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜'));
    }

    // â”€â”€â”€ ê²€ìƒ‰ ë²„íŠ¼ & Enter í‚¤ â”€â”€â”€
    document.getElementById('searchButton').onclick = () => {
        const q = input.value.trim();
        if(!q) return alert('ì£¼ì†Œ ë˜ëŠ” í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        geocoder.addressSearch(q, (res, stat) => {
            if(stat===kakao.maps.services.Status.OK) handleResult(res, stat);
            else ps.keywordSearch(q, (data, stat2) => {
                if(stat2===kakao.maps.services.Status.OK) handleResult(data.map(p=>({x:p.x,y:p.y})), stat2);
                else alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            });
        });
    };
    input.addEventListener('keydown', e => { if(e.key==='Enter') document.getElementById('searchButton').click(); });


    // ë§¤ë¬¼ ë Œë”ë§
    function renderSearchResult(data) {
        console.log('[renderSearchResult] data length:', data.length);
        clusterer.clear();
        const markers = data.map(h => {
            console.log('h.location.coordinates:', h.location.coordinates);
            const [lng, lat] = h.location.coordinates;
            const m = new kakao.maps.Marker({ position: new kakao.maps.LatLng(lat, lng) });
            kakao.maps.event.addListener(m, 'click', () => {
                destLat = lat; destLng = lng; openDetailPanel(h);
            });
            const iw = new kakao.maps.InfoWindow({
                content: `<div style="padding:5px;"><b>${h.buildingName||'â€“'}</b><br/>ì›”ì„¸: ${h.rentPrc||'â€“'}<br/>ë³´ì¦ê¸ˆ: ${h.dealOrWarrantPrc||'â€“'}</div>`
            });
            kakao.maps.event.addListener(m, 'mouseover', ()=>iw.open(map,m));
            kakao.maps.event.addListener(m, 'mouseout', ()=>iw.close());
            m.houseData = h;
            return m;
        });
        console.log('[markers count]', markers.length);
        clusterer.addMarkers(markers);
        renderHouseList(data);
        closeDetailPanel();
    }

    // function renderSearchResult(data) {
    //     clusterer.clear();
    //     const markers = data.map(h => {
    //         const [lng, lat] = h.location.coordinates;
    //         const m = new kakao.maps.Marker({position: new kakao.maps.LatLng(lat, lng)});
    //         m.houseData = h;
    //         const iw = new kakao.maps.InfoWindow({content:
    //                 `<div style="padding:5px;"><b>${h.buildingName || 'ê±´ë¬¼ëª… ë¯¸ê¸°ì¬'}</b><br/>
    //    ì›”ì„¸:${h.rentPrc || '-'}<br/>ë³´ì¦ê¸ˆ:${h.dealOrWarrantPrc || '-'}</div>`});
    //         kakao.maps.event.addListener(m, 'mouseover', () => iw.open(map, m));
    //         kakao.maps.event.addListener(m, 'mouseout', () => iw.close());
    //         return m;
    //     });
    //     clusterer.addMarkers(markers);
    //     renderHouseList(data);
    //     closeDetailPanel();
    //     document.getElementById('directionResult').innerText = 'ì—¬ê¸°ì— ê¸¸ì°¾ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
    // }

    // í´ëŸ¬ìŠ¤í„° í´ë¦­
    kakao.maps.event.addListener(clusterer, 'clusterclick', c => {
        // 1) ë§¤ë¬¼ ëª©ë¡ë§Œ ê°±ì‹ 
        const arr = c.getMarkers().map(m => m.houseData);
        renderHouseList(arr);

        // 2) destLat/destLng ì—…ë°ì´íŠ¸
        const cen = c.getCenter();
        destLat = cen.getLat();
        destLng = cen.getLng();

        // 3) ì§€ë„ë§Œ ì´ë™ (ê¸°ì¡´ ê²½ë¡œ/ë§í’ì„ ì€ ìœ ì§€)
        map.setCenter(cen);
        document.getElementById('directionResult').innerText = 'ì—¬ê¸°ì— ê¸¸ì°¾ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
    });

    // ê¸¸ì°¾ê¸°
    document.getElementById('directionBtn').onclick = () => {
        if(!searchedLat||!searchedLng) return alert("ë¨¼ì € ì£¼ì†Œ ê²€ìƒ‰ì„ í•´ì£¼ì„¸ìš”!");
        if(!destLat||!destLng) return alert("ëª©ì ì§€(ë§¤ë¬¼)ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        if(straightLine) straightLine.setMap(null);
        straightLine = new kakao.maps.Polyline({
            path: [ new kakao.maps.LatLng(searchedLat, searchedLng), new kakao.maps.LatLng(destLat, destLng) ],
            strokeWeight:4, strokeColor:'#888', strokeOpacity:0.8, strokeStyle:'dash'
        });
        straightLine.setMap(map);
        if(destMarker) destMarker.setMap(null);
        destMarker = new kakao.maps.CustomOverlay({
            map, position:new kakao.maps.LatLng(destLat,destLng),
            content:'<div class="dest-bubble">ë„ì°©</div>', yAnchor:1
        });
        fetch(`/house/direction?originLat=${searchedLat}&originLng=${searchedLng}&destLat=${destLat}&destLng=${destLng}`)
            .then(r=>r.json())
            .then(d=>{
                if(routeLine) routeLine.setMap(null);
                const kakaoPath = decodePolyline(d.polyline);
                routeLine = new kakao.maps.Polyline({ path:kakaoPath, strokeWeight:4, strokeColor:'#007aff', strokeOpacity:0.8, strokeStyle:'solid' });
                routeLine.setMap(map);
                document.getElementById('directionResult').innerHTML =
                    `<h3>ê¸¸ì°¾ê¸° ê²°ê³¼ (ë„ë³´ + ëŒ€ì¤‘êµí†µ)</h3>
                     <p><b>ì´ë™ê±°ë¦¬:</b> ${d.distance}</p>
                     <p><b>ì†Œìš”ì‹œê°„:</b> ${d.duration}</p>`;
            }).catch(e=>{
            console.error(e);
            alert("ê¸¸ì°¾ê¸° API í˜¸ì¶œ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        });
    };

    // ë¦¬ìŠ¤íŠ¸ & ìƒì„¸
    function renderHouseList(arr) {
        const list = document.getElementById('houseListContent');
        if(!arr.length) return list.innerHTML = '<p>ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        list.innerHTML = arr.map((h,i)=>`
            <div class="house-item" data-idx="${i}">
                <div class="house-title">${h.buildingName||'-'}</div>
                <div class="house-info">
                    ë°©íƒ€ì…:${h.articleName||'-'}<br/>
                    ì›”ì„¸:${h.rentPrc||'-'}<br/>
                    ë³´ì¦ê¸ˆ:${h.dealOrWarrantPrc||'-'}<br/>
                    ë°©í–¥:${h.direction||'-'}
                </div>
            </div>
        `).join('');
        list.querySelectorAll('.house-item').forEach((el,i)=>el.onclick=()=>openDetailPanel(arr[i]));
    }

    const detailPanel   = document.getElementById('houseDetail');
    const detailContent = document.getElementById('detailContent');

    document.getElementById('closeDetailBtn').onclick = closeDetailPanel;
    function closeDetailPanel(){ document.getElementById('houseDetail').style.display='none'; }

    function openDetailPanel(house){
        if(!house) return;
        const [lng, lat] = house.location.coordinates;
        destLat = lat; destLng = lng;
        const detailContent = document.getElementById('detailContent');
        const fields = [
            { label:'ì§€ì—­', value:house.region },
            { label:'ë°©íƒ€ì…', value:house.articleName },
            { label:'ì§€ë¶ˆ ìœ í˜•', value:house.tradeTypeName },
            { label:'ê±´ë¬¼ì´ë¦„', value:house.buildingName },
            { label:'ë§¤ë¬¼ ì¸µ', value:house.floorInfo },
            { label:'ì „ì²´ ë©´ì ', value:house.area1 },
            { label:'ì‚¬ìš©ë©´ì ', value:house.area2 },
            { label:'ìœ„ë„', value:lat },
            { label:'ê²½ë„', value:lng },
            { label:'ë°©í–¥', value:house.direction },
            { label:'ë“±ë¡ ë‚ ì§œ', value:house.articleConfirmYmd },
            { label:'ì›”ì„¸', value:house.rentPrc },
            { label:'íƒœê·¸', value:house.tagList },
            { label:'ìƒì„¸ ì„¤ëª…', value:house.articleFeatureDesc },
            { label:'ë³´ì¦ê¸ˆ', value:house.dealOrWarrantPrc },
            { label:'ì—˜ë¦¬ë² ì´í„° ìˆ˜', value:house.elevatorCount },
            { label:'ê°™ì€ ë§¤ë¬¼ ê°œìˆ˜', value:house.sameAddrCnt },
            { label:'ê°™ì€ ë§¤ë¬¼ ìµœì†Œê°€ê²©', value:house.sameAddrMinPrc },
            { label:'ê³µì¸ì¤‘ê°œì‚¬', value:house.realtorName },
            { label:'ì‚¬ì´íŠ¸ ID', value:house.cpid },
            { label:'ì‚¬ì´íŠ¸ ì´ë¦„', value:house.cpName },
            { label:'ì‚¬ì´íŠ¸ URL', value:house.cpPcArticleUrl }
        ];
        detailContent.innerHTML = fields.map(f=>`
            <div class="detail-row">
                <span class="detail-label">${f.label}:</span>
                <span>${f.value!=null?f.value:'-'}</span>
            </div>
        `).join('');
        document.getElementById('houseDetail').style.display='block';
    }




    // document.getElementById('searchButton').onclick = () => {
    //     const addr = document.getElementById('addressInput').value.trim();
    //     if (!addr) {
    //         alert("ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    //         return;
    //     }
    //
    //     const selectedTypes = Array.from(document.querySelectorAll('input[name="tradeType"]:checked'))
    //         .map(cb => cb.value);
    //     if (selectedTypes.length === 0) {
    //         alert("ì„ëŒ€ ìœ í˜•ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.");
    //         return;
    //     }
    //
    //     const rentMin = document.getElementById('rentPrcMin').value.trim();
    //     const rentMax = document.getElementById('rentPrcMax').value.trim();
    //     const dealMin = document.getElementById('dealPrcMin').value.trim();
    //     const dealMax = document.getElementById('dealPrcMax').value.trim();
    //
    //     const rentPrcMin = rentMin === "" ? 0 : parseInt(rentMin);
    //     const rentPrcMax = rentMax === "" ? 999999999 : parseInt(rentMax);
    //     const dealPrcMin = dealMin === "" ? 0 : parseInt(dealMin);
    //     const dealPrcMax = dealMax === "" ? 999999999 : parseInt(dealMax);
    //
    //     new kakao.maps.services.Geocoder().addressSearch(addr, (res, stat) => {
    //         if (stat !== kakao.maps.services.Status.OK) {
    //             alert("ì£¼ì†Œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
    //             return;
    //         }
    //
    //         const lng = parseFloat(res[0].x), lat = parseFloat(res[0].y);
    //         searchedLat = lat; searchedLng = lng; destLat = destLng = null;
    //         map.setCenter(new kakao.maps.LatLng(lat, lng));
    //
    //         if (addressMarker) addressMarker.setMap(null);
    //         if (companyLabel) companyLabel.setMap(null);
    //
    //         addressMarker = new kakao.maps.Marker({
    //             position: new kakao.maps.LatLng(lat, lng),
    //             map
    //         });
    //
    //         companyLabel = new kakao.maps.CustomOverlay({
    //             position: addressMarker.getPosition(), yAnchor: 1.4,
    //             content: `<div style="padding:4px 8px;background:#0066ff;color:#fff;
    //                       border-radius:4px;font-size:13px;white-space:nowrap">íšŒì‚¬ ìœ„ì¹˜</div>`
    //         });
    //         companyLabel.setMap(map);
    //
    //         // âœ… íˆ¬ë£¸ API ì‚¬ìš©
    //         const typeParams = selectedTypes.map(t => `tradeTypeCodes=${t}`).join('&');
    //         const priceParams = `rentPrcMin=${rentPrcMin}&rentPrcMax=${rentPrcMax}&dealPrcMin=${dealPrcMin}&dealPrcMax=${dealPrcMax}`;
    //         const fullURL = `/house/two?lng=${lng}&lat=${lat}&radius=3&${typeParams}&${priceParams}`;
    //
    //         fetch(fullURL)
    //             .then(r => r.json())
    //             .then(renderSearchResult)
    //             .catch(e => {
    //                 console.error(e);
    //                 alert("ì„œë²„ í˜¸ì¶œ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    //             });
    //     });
    // };


</script>
</body>
</html>
