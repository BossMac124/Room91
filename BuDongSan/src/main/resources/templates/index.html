<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>ë¶€ë™ì‚° ë§¤ë¬¼ ì§€ë„ â€“ ê¸¸ì°¾ê¸° ê²°ê³¼</title>
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c0621bc4a0f59aff38dbd93a18f3ec6f&libraries=services,clusterer"></script>
    <style>
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: sans-serif }
        nav { background: #007aff; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center }

        #mainLayout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        #houseList {
            width: 300px;
            padding: 10px;
            overflow-y: auto;
            height: 100%;
            box-sizing: border-box;
        }
        #mapWrapper {
            flex: 1;
            overflow: hidden;
        }

        nav button { background: white; color: #007aff; border: none; border-radius: 4px; padding: 6px 12px; cursor: pointer; font-size: 14px }
        nav button.active { background: #005fcc; color: white }
        #mainLayout { display: flex; flex: 1 }
        #houseList { width: 300px; border-right: 1px solid #ccc; padding: 10px; background: #fafafa; overflow-y: auto }
        #directionBtn { width: 100%; padding: 8px; margin-bottom: 10px; border: none; border-radius: 4px; background: #007aff; color: #fff; font-size: 16px; cursor: pointer }
        #directionResult { border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-bottom: 10px; background: #fff }
        #houseListContent .house-item { padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; background: #fff; cursor: pointer }
        #houseListContent .house-item:hover { background: #f0f0f0 }
        .house-title { font-weight: bold; margin-bottom: 5px }
        .house-info { font-size: 14px; color: #666 }
        #houseDetail { width: 400px; border-right: 1px solid #ccc; padding: 10px; background: #fff; display: none; overflow-y: auto }
        #detailHeader { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px }
        #detailHeader h3 { margin: 0; font-size: 18px }
        #closeDetailBtn { background: none; border: none; font-size: 18px; cursor: pointer; color: #999 }
        #closeDetailBtn:hover { color: #333 }
        .detail-row { margin-bottom: 6px }
        .detail-label { font-weight: bold; margin-right: 5px }
        #mapWrapper { flex: 1; position: relative }
        #map { width: 100%; height: 100% }
        #searchForm { position: absolute; top: 10px; left: 10px; z-index: 2; background: #fff; padding: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,.3) }

        /* â”€â”€â”€ ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ â”€â”€â”€ */
        #autocompleteList {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #ccc;
            z-index: 1000;
            margin: 0;
            padding: 0;
            list-style: none;
        }
        #autocompleteList li {
            padding: 8px 12px;
            cursor: pointer;
        }
        #autocompleteList li:hover {
            background: #f0f0f0;
        }

        /* ë§í’ì„  ì»¨í…Œì´ë„ˆ */
        .dest-bubble {
            display: inline-block;
            position: relative;
            padding: 6px 12px;
            background: #FF746C;         /* ë°°ê²½ìƒ‰ */
            color: #fff;                 /* ê¸€ììƒ‰ */
            font-size: 14px;
            font-weight: bold;
            border-radius: 12px;         /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            white-space: nowrap;
        }

        /* ë§í’ì„  ì•„ë˜ ì‚¼ê°í˜•(ê¼¬ë¦¬) */
        .dest-bubble::after {
            content: "";
            position: absolute;
            bottom: -6px;                /* ë§í’ì„  ì•„ë˜ì— ë°°ì¹˜ */
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px 6px 0 6px; /* ìœ„ìª½ì´ ì‚¼ê°í˜• */
            border-style: solid;
            border-color: #FF746C transparent transparent transparent;
        }

    </style>
</head>
<body>

<nav>
    <div style="font-size: 18px; font-weight: bold;">ğŸ  ë¶€ë™ì‚° ë§¤ë¬¼ ì§€ë„</div>
    <div>
        <button id="oneBtn">ì›ë£¸</button>
        <button id="twoBtn">íˆ¬ë£¸</button>
    </div>
</nav>

<div id="mainLayout">
    <div id="houseList">
        <button id="directionBtn">ê¸¸ì°¾ê¸°</button>
        <div id="directionResult">ì—¬ê¸°ì— ê¸¸ì°¾ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
        <div id="houseListContent"><p>ë§¤ë¬¼ ëª©ë¡ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</p></div>
    </div>

    <div id="houseDetail">
        <div id="detailHeader">
            <h3>ë§¤ë¬¼ ìƒì„¸ ì •ë³´</h3>
            <button id="closeDetailBtn">X</button>
        </div>
        <div id="detailContent"></div>
    </div>

    <div id="mapWrapper">
        <div id="searchForm">
            <div style="margin-bottom:5px">
                <label><input type="checkbox" name="tradeType" value="B1" checked> ì „ì„¸</label>
                <label><input type="checkbox" name="tradeType" value="B2" checked> ì›”ì„¸</label>
                <label><input type="checkbox" name="tradeType" value="B3" checked> ë‹¨ê¸°ì„ëŒ€</label>
            </div>
            <div style="margin-bottom:5px">
                <label><b>ì›”ì„¸ ë²”ìœ„ (ë§Œì›)</b></label><br>
                <input id="rentPrcMin" type="number" placeholder="ìµœì†Œ" style="width:60px"> ~
                <input id="rentPrcMax" type="number" placeholder="ìµœëŒ€" style="width:60px">
            </div>
            <div style="margin-bottom:5px">
                <label><b>ë³´ì¦ê¸ˆ ë²”ìœ„ (ë§Œì›)</b></label><br>
                <input id="dealPrcMin" type="number" placeholder="ìµœì†Œ" style="width:60px"> ~
                <input id="dealPrcMax" type="number" placeholder="ìµœëŒ€" style="width:60px">
            </div>
            <!-- â”€â”€â”€ ê²€ìƒ‰ì°½ + ìë™ì™„ì„± ë˜í¼ â”€â”€â”€ -->
            <div style="position:relative;">
                <input id="addressInput" placeholder="ì£¼ì†Œ ë° í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" style="width:200px">
                <ul id="autocompleteList"></ul>  <!-- ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ -->
                <button id="searchButton">ê²€ìƒ‰</button>
            </div>
        </div>
        <div id="map"></div>
    </div>
</div>

<script>
    // ë„¤ë¹„ê²Œì´ì…˜
    function goToOneRoom() { window.location.href = "/"; }
    function goToTwoRoom() { window.location.href = "/two"; }
    document.getElementById("oneBtn").addEventListener("click", goToOneRoom);
    document.getElementById("twoBtn").addEventListener("click", goToTwoRoom);
    const pathname = window.location.pathname;
    if (pathname === "/") document.getElementById("oneBtn").classList.add("active");
    if (pathname === "/two") document.getElementById("twoBtn").classList.add("active");
    let routeLine = null;      // í´ë¦¬ë¼ì¸ ê°ì²´
    let destMarker = null;     // ë„ì°©ì§€ ë§ˆì»¤

    // ì „ì„¸ë§Œ ì„ íƒ ì‹œ ì›”ì„¸ í•„í„° ë¹„í™œì„±í™”
    function updateRentFilterStatus() {
        const sel = Array.from(document.querySelectorAll('input[name="tradeType"]:checked')).map(i=>i.value);
        const onlyJeonse = sel.length===1 && sel[0]==="B1";
        ["rentPrcMin","rentPrcMax"].forEach(id=>{
            const inp=document.getElementById(id);
            inp.disabled = onlyJeonse;
            inp.style.backgroundColor = onlyJeonse ? "#eee" : "white";
        });
    }
    document.querySelectorAll('input[name="tradeType"]').forEach(el=>el.addEventListener('change', updateRentFilterStatus));
    updateRentFilterStatus();

    // â‘  ì¹´ì¹´ì˜¤ ë§µ ì´ˆê¸°í™”
    let searchedLat, searchedLng, destLat, destLng;
    let addressMarker, companyLabel;
    const map = new kakao.maps.Map(
        document.getElementById('map'),
        { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 5 }
    );

    // â‘¡ í´ëŸ¬ìŠ¤í„°ë§ ì´ˆê¸°í™” ì½”ë“œ
    const clusterer = new kakao.maps.MarkerClusterer({ map, averageCenter:true, minLevel:2, minClusterSize:1 });

    // â‘¢ decodePolyline í•¨ìˆ˜ ì •ì˜
    function decodePolyline(encoded) {
        const path = [];
        let index = 0, lat = 0, lng = 0;

        while (index < encoded.length) {
            let b, shift = 0, result = 0;
            do {
                b = encoded.charCodeAt(index++) - 63;
                result |= (b & 0x1f) << shift;
                shift += 5;
            } while (b >= 0x20);
            lat += (result & 1) ? ~(result >> 1) : (result >> 1);

            shift = 0; result = 0;
            do {
                b = encoded.charCodeAt(index++) - 63;
                result |= (b & 0x1f) << shift;
                shift += 5;
            } while (b >= 0x20);
            lng += (result & 1) ? ~(result >> 1) : (result >> 1);

            path.push(new kakao.maps.LatLng(lat * 1e-5, lng * 1e-5));
        }
        return path;
    }

    // í‚¤ì›Œë“œ ê²€ìƒ‰
    const ps = new kakao.maps.services.Places();    // ì¥ì†Œ ê²€ìƒ‰ìš© ì„œë¹„ìŠ¤
    const geocoder = new kakao.maps.services.Geocoder();    // ì£¼ì†Œ ê²€ìƒ‰ìš© ì„œë¹„ìŠ¤

    // ìë™ì™„ì„± ê¸°ëŠ¥
    const input    = document.getElementById('addressInput');
    const autoList = document.getElementById('autocompleteList');

    input.addEventListener('input',()=>{
        const kw = input.value.trim();
        if(!kw){ autoList.innerHTML=''; return; }
        ps.keywordSearch(kw, (data, status)=>{
            if(status===kakao.maps.services.Status.OK){
                autoList.innerHTML = data.map(place=>
                    `<li data-lng="${place.x}" data-lat="${place.y}">${place.place_name}</li>`
                ).join('');
            }
        });
    });

    autoList.addEventListener('click', e=>{
        if(e.target.tagName!=='LI') return;
        const name = e.target.textContent;
        const lng = e.target.dataset.lng;
        const lat = e.target.dataset.lat;
        input.value = name;
        autoList.innerHTML = '';
        handleResult([{x:lng,y:lat}], kakao.maps.services.Status.OK);
    });

    document.addEventListener('click', e=>{
        if(!document.getElementById('searchForm').contains(e.target)){
            autoList.innerHTML = '';
        }
    });

    // ê²€ìƒ‰ ê²°ê³¼ ê³µí†µ ì²˜ë¦¬
    function handleResult(res, status) {
        if (status !== kakao.maps.services.Status.OK) {
            alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        const lng = parseFloat(res[0].x),
            lat = parseFloat(res[0].y);
        setCenterAndSearch(lat, lng);
    }

    function setCenterAndSearch(lat, lng) {
        // 1) ì „ì—­ ìœ„ë„Â·ê²½ë„ ì €ì¥
        searchedLat = lat;
        searchedLng = lng;
        destLat = destLng = null;

        // 2) ì§€ë„ ì¤‘ì‹¬ ì´ë™
        map.setCenter(new kakao.maps.LatLng(lat, lng));

        // 3) ê¸°ì¡´ íšŒì‚¬ ìœ„ì¹˜ ë§ˆì»¤/ë ˆì´ë¸” ì œê±°
        if (addressMarker) addressMarker.setMap(null);
        if (companyLabel) companyLabel.setMap(null);

        // 4) íšŒì‚¬ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
        addressMarker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(lat, lng),
            map
        });
        companyLabel = new kakao.maps.CustomOverlay({
            position: addressMarker.getPosition(),
            yAnchor: 1.4,
            content: '<div style="padding:4px 8px; background:#0066ff; color:#fff; border-radius:4px; white-space:nowrap">íšŒì‚¬ ìœ„ì¹˜</div>'
        });
        companyLabel.setMap(map);

        // 5) í•„í„°Â·ê°€ê²© ì •ë³´ ë‹¤ì‹œ ì½ê¸°
        const types = Array.from(
            document.querySelectorAll('input[name="tradeType"]:checked')
        ).map(c => c.value);
        const rMin = parseInt(document.getElementById('rentPrcMin').value) || 0;
        const rMax = parseInt(document.getElementById('rentPrcMax').value) || 999999999;
        const dMin = parseInt(document.getElementById('dealPrcMin').value) || 0;
        const dMax = parseInt(document.getElementById('dealPrcMax').value) || 999999999;

        // 6) ë§¤ë¬¼ ì¡°íšŒ API í˜¸ì¶œ
        const urlPath = pathname === '/' ? '/house' : '/house/two';
        const params = [
            `lng=${lng}`,
            `lat=${lat}`,
            `radius=3`,
            ...types.map(t => `tradeTypeCodes=${t}`),
            `rentPrcMin=${rMin}`, `rentPrcMax=${rMax}`,
            `dealPrcMin=${dMin}`, `dealPrcMax=${dMax}`
        ].join('&');

        fetch(`${urlPath}?${params}`)
            .then(res => res.json())
            .then(renderSearchResult)
            .catch(() => alert('ë§¤ë¬¼ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜'));
    }

    // ë§¤ë¬¼ ê²€ìƒ‰ (ì£¼ì†Œ, í‚¤ì›Œë“œ ë¶„ê¸°)
    document.getElementById('searchButton').onclick = () => {
        const q = document.getElementById('addressInput').value.trim();
        if (!q) { alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }

        const types = Array.from(
            document.querySelectorAll('input[name="tradeType"]:checked')
        ).map(c => c.value);
        if (!types.length) { alert('ì„ëŒ€ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }

        // 1) ì£¼ì†Œ ê²€ìƒ‰ ìš°ì„ 
        geocoder.addressSearch(q, (res, stat) => {
            if (stat === kakao.maps.services.Status.OK) {
                // ë™/ë„ë¡œëª… ê²€ìƒ‰ ê²°ê³¼ ìˆìœ¼ë©´ ë°”ë¡œ ì²˜ë¦¬
                handleResult(res, stat);
            } else {
                // ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨(ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ POIì¼ ë•Œ) â†’ í‚¤ì›Œë“œ ê²€ìƒ‰
                ps.keywordSearch(q, handleResult);
            }
        });
        // const addr = document.getElementById('addressInput').value.trim();
        // if (!addr) { alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
        // const types = Array.from(document.querySelectorAll('input[name="tradeType"]:checked')).map(c=>c.value);
        // if (types.length===0) { alert('ì„ëŒ€ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
        // const rMin = document.getElementById('rentPrcMin').value.trim(), rMax = document.getElementById('rentPrcMax').value.trim();
        // const dMin = document.getElementById('dealPrcMin').value.trim(), dMax = document.getElementById('dealPrcMax').value.trim();
        // const rentPrcMin = rMin===''?0:parseInt(rMin), rentPrcMax = rMax===''?999999999:parseInt(rMax);
        // const dealPrcMin = dMin===''?0:parseInt(dMin), dealPrcMax = dMax===''?999999999:parseInt(dMax);
        // new kakao.maps.services.Geocoder().addressSearch(addr, (res, stat) => {
        //     if (stat!==kakao.maps.services.Status.OK) { alert('ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨'); return; }
        //     const lng = parseFloat(res[0].x), lat = parseFloat(res[0].y);
        //     searchedLat=lat; searchedLng=lng; destLat=destLng=null;
        //     map.setCenter(new kakao.maps.LatLng(lat,lng));
        //     if (addressMarker) addressMarker.setMap(null);
        //     if (companyLabel) companyLabel.setMap(null);
        //     addressMarker = new kakao.maps.Marker({ position:new kakao.maps.LatLng(lat,lng), map });
        //     companyLabel = new kakao.maps.CustomOverlay({ position:addressMarker.getPosition(), yAnchor:1.4,
        //         content: '<div style="padding:4px 8px;background:#0066ff;color:#fff;border-radius:4px;white-space:nowrap">íšŒì‚¬ ìœ„ì¹˜</div>'
        //     }); companyLabel.setMap(map);
        //     const urlPath = pathname==='/'?'/house':'/house/two';
        //     const params = [`lng=${lng}`,`lat=${lat}`,`radius=3`, ...types.map(t=>`tradeTypeCodes=${t}`), `rentPrcMin=${rentPrcMin}`, `rentPrcMax=${rentPrcMax}`, `dealPrcMin=${dealPrcMin}`, `dealPrcMax=${dealPrcMax}`].join('&');
        //     fetch(`${urlPath}?${params}`)
        //         .then(r=>r.json()).then(renderSearchResult).catch(e=>{ console.error(e); alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜'); });
        // });
    };

    // ê²€ìƒ‰ì°½ì— Enterí‚¤ ì´ë²¤íŠ¸
    document.getElementById('addressInput').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('searchButton').click();
        }
    });

    // ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§
    function renderSearchResult(data) {
        clusterer.clear();
        const markers = data.map(h => {
            const [lng,lat] = h.location.coordinates;
            const m = new kakao.maps.Marker({ position:new kakao.maps.LatLng(lat,lng) });
            m.houseData = h;
            const iw = new kakao.maps.InfoWindow({ content:`<div style="padding:5px;"><b>${h.buildingName||'-'}</b><br/>ì›”ì„¸:${h.rentPrc||'-'}<br/>ë³´ì¦ê¸ˆ:${h.dealOrWarrantPrc||'-'}</div>` });
            kakao.maps.event.addListener(m,'mouseover',()=>iw.open(map,m));
            kakao.maps.event.addListener(m,'mouseout',()=>iw.close());
            return m;
        }); clusterer.addMarkers(markers);
        renderHouseList(data); closeDetailPanel();
        document.getElementById('directionResult').innerText = 'ì—¬ê¸°ì— ê¸¸ì°¾ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
    }

    // í´ëŸ¬ìŠ¤í„° í´ë¦­
    kakao.maps.event.addListener(clusterer,'clusterclick', c => {
        const arr = c.getMarkers().map(m => m.houseData);
        renderHouseList(arr);
        const cen = c.getCenter();
        destLat = cen.getLat();
        destLng = cen.getLng();
        closeDetailPanel();
        document.getElementById('directionResult').innerText = 'ì—¬ê¸°ì— ê¸¸ì°¾ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
    });

    // ê¸¸ì°¾ê¸°
    document.getElementById('directionBtn').onclick = () => {
        if (!searchedLat||!searchedLng) { alert('ì£¼ì†Œ ê²€ìƒ‰ ë¨¼ì €'); return; }
        if (!destLat||!destLng) { alert('ëª©ì ì§€ ì„ íƒ í•„ìš”'); return; }

        // â‘  ì´ì „ ì„ Â·ë§ˆì»¤ ì œê±°
        if (routeLine) {
            routeLine.setMap(null);
            routeLine = null;
        }
        if (destMarker) {
            destMarker.setMap(null);
            destMarker = null;
        }

        // â‘¡ ì¶œë°œì§€â†’ë„ì°©ì§€ í´ë¦¬ë¼ì¸ ê·¸ë¦¬ê¸°
        const path = [
            new kakao.maps.LatLng(searchedLat, searchedLng),
            new kakao.maps.LatLng(destLat, destLng)
        ];
        routeLine = new kakao.maps.Polyline({
            path: path,                // ê¸°ì¡´ ê²½ë¡œ ê·¸ëŒ€ë¡œ
            strokeWeight: 4,           // ì„  êµµê¸°
            strokeColor: '#888',       // íšŒìƒ‰ ê³„ì—´
            strokeOpacity: 0.8,        // ë¶ˆíˆ¬ëª…ë„
            strokeStyle: 'dash'        // ì ì„  ìŠ¤íƒ€ì¼ ('solid', 'dash', 'dot', 'longdash', 'shortdash', ë“±)
        });
        routeLine.setMap(map);

        // â‘¢ ë„ì°©ì§€ ë§í’ì„ (CustomOverlay) ì¶”ê°€
        const bubbleContent = '<div class="dest-bubble">ë„ì°©</div>';
        destMarker = new kakao.maps.CustomOverlay({
            map: map,
            position: new kakao.maps.LatLng(destLat, destLng),
            content: bubbleContent,
            yAnchor: 1
        });
        destMarker.setZIndex(999); // ìµœìƒë‹¨ì— í‘œì‹œ

        // â‘£ ê±°ë¦¬Â·ì‹œê°„ ì •ë³´ í‘œì‹œ
        fetch(`/house/direction?originLat=${searchedLat}&originLng=${searchedLng}&destLat=${destLat}&destLng=${destLng}`)
            .then(res => res.json())
            .then(data => {
                // 1) ê¸°ì¡´ ê²½ë¡œ ì œê±°
                if (routeLine) routeLine.setMap(null);

                // 2) Kakao LatLng ê°ì²´ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
                const kakaoPath = data.pathCoords.map(p =>
                    new kakao.maps.LatLng(p.lat, p.lng)
                );

                // 3) ì‹¤ì œ ë„ë¡œ ê²½ë¡œì„  ê·¸ë¦¬ê¸°
                routeLine = new kakao.maps.Polyline({
                    path: kakaoPath,
                    strokeWeight: 4,
                    strokeColor: '#007aff',
                    strokeOpacity: 0.8,
                    strokeStyle: 'solid'
                });
                routeLine.setMap(map);

                // 4) ê±°ë¦¬Â·ì‹œê°„ ë° â€œë„ì°©â€ ë§í’ì„  í‘œì‹œ ë¡œì§ ê¸°ì¡´ ê·¸ëŒ€ë¡œ
                document.getElementById('directionResult').innerHTML =
                    `<h3>ê¸¸ì°¾ê¸° ê²°ê³¼</h3>
                     <p>ê±°ë¦¬: ${data.distance}</p>
                     <p>ì‹œê°„: ${data.duration}</p>`;
            })
            .catch(_ => alert('ê¸¸ì°¾ê¸° ì˜¤ë¥˜'));

        // fetch(`/house/direction?originLat=${searchedLat}&originLng=${searchedLng}&destLat=${destLat}&destLng=${destLng}`)
        //     .then(r=>r.json())
        //     .then(d => { document.getElementById('directionResult').innerHTML = `<h3>ê¸¸ì°¾ê¸° ê²°ê³¼</h3><p>ê±°ë¦¬: ${d.distance}</p><p>ì‹œê°„: ${d.duration}</p>`; })
        //     .catch(_=>alert('ê¸¸ì°¾ê¸° ì˜¤ë¥˜'));
    };

    // ë§¤ë¬¼ ëª©ë¡ ë Œë”ë§
    function renderHouseList(arr) {
        const list = document.getElementById('houseListContent');
        if (!arr.length) { list.innerHTML = '<p>ë§¤ë¬¼ ì—†ìŒ</p>'; return; }
        list.innerHTML = arr.map((h, i) =>
            `<div class="house-item" data-idx="${i}">
                <div class="house-title">${h.buildingName||'-'}</div>
                <div class="house-info">
                    ë°©íƒ€ì…: ${h.articleName||'-'}<br/>
                    ì›”ì„¸: ${h.rentPrc||'-'}<br/>
                    ë³´ì¦ê¸ˆ: ${h.dealOrWarrantPrc||'-'}<br/>
                    ë°©í–¥: ${h.direction||'-'}
                </div>
            </div>`
        ).join('');
        list.querySelectorAll('.house-item').forEach((el, i) =>
            el.onclick = () => openDetailPanel(arr[i])
        );
    }

    // ìƒì„¸ì¡°íšŒ - ì „ì²´ í•„ë“œ
    const detailPanel = document.getElementById('houseDetail');
    const detailContent = document.getElementById('detailContent');
    document.getElementById('closeDetailBtn').onclick = closeDetailPanel;

    function openDetailPanel(h) {
        if (!h) return;
        const fields = [
            { label: 'ì§€ì—­', value: h.region },
            { label: 'ë°© íƒ€ì…', value: h.articleName },
            { label: 'ì§€ë¶ˆ ìœ í˜•', value: h.tradeTypeName },
            { label: 'ê±´ë¬¼ì´ë¦„', value: h.buildingName },
            { label: 'ë§¤ë¬¼ ì¸µ', value: h.floorInfo },
            { label: 'ì „ì²´ ë©´ì ', value: h.area1 },
            { label: 'ì‚¬ìš© ë©´ì ', value: h.area2 },
            { label: 'ê²½ë„', value: h.latitude },
            { label: 'ìœ„ë„', value: h.longitude },
            { label: 'ë°©í–¥', value: h.direction },
            { label: 'ë“±ë¡ ë‚ ì§œ', value: h.articleConfirmYmd },
            { label: 'ì›”ì„¸', value: h.rentPrc },
            { label: 'ë³´ì¦ê¸ˆ', value: h.dealOrWarrantPrc },
            { label: 'íƒœê·¸ ë¦¬ìŠ¤íŠ¸', value: h.tagList },
            { label: 'ìƒì„¸ ì„¤ëª…', value: h.articleFeatureDesc },
            { label: 'ì—˜ë¦¬ë² ì´í„° ìˆ˜', value: h.elevatorCount },
            { label: 'ë™ì¼ ì£¼ì†Œ ë§¤ë¬¼ìˆ˜', value: h.sameAddrCnt },
            { label: 'ë™ì¼ ì£¼ì†Œ ìµœì†Œê°€', value: h.sameAddrMinPrc },
            { label: 'ë™ì¼ ì£¼ì†Œ ìµœê³ ê°€', value: h.sameAddrMaxPrc },
            { label: 'ê³µì¸ì¤‘ê°œì‚¬', value: h.realtorName },
            { label: 'ë§¤ë¬¼ë“±ë¡ì‚¬ì´íŠ¸ ID', value: h.cpid },
            { label: 'ë§¤ë¬¼ë“±ë¡ì‚¬ì´íŠ¸ ì´ë¦„', value: h.cpName },
            { label: 'PC URL', value: h.cpPcArticleUrl },
            { label: 'ëª¨ë°”ì¼ URL', value: h.cpMobileArticleUrl }
        ];
        detailContent.innerHTML = fields.map(f => `
            <div class="detail-row">
                <span class="detail-label">${f.label}:</span>
                <span>${f.value !== null && f.value !== undefined ? f.value : '-'}</span>
            </div>
        `).join('');
        detailPanel.style.display = 'block';
    }
    function closeDetailPanel() {
        detailPanel.style.display = 'none';
    }
</script>

</body>
</html>