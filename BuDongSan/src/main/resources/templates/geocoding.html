<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>재개발 지역 조회</title>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY&libraries=services"></script>
    <style>
        /* 지도 크기 설정 */
        #map { width: 100%; height: 500px; }
        .left-panel { width: 300px; float: left; }
    </style>
</head>
<body>

<div class="left-panel">
    <!-- 시군구 선택 -->
    <select id="citySelect" onchange="onCityChange()">
        <option value="">시군구 선택</option>
    </select>

    <!-- 법정동 선택 -->
    <select id="neighborhoodSelect" onchange="onNeighborhoodChange()">
        <option value="">법정동 선택</option>
    </select>

    <!-- 데이터 출력 부분 -->
    <div id="dataOutput">
        <!-- 데이터는 여기서 보여짐 -->
    </div>
</div>

<!-- 시군구 목록 가져오기 -->
<script>
    window.onload = function () {
        fetch('/api/deals/district') // 백엔드에서 시군구 데이터 가져옴
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('citySelect');
                data.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    select.appendChild(option);
                });
            })
            .catch(error => console.log('시군구 데이터 가져오기 실패', error));
    };
</script>

<!-- 시군구 선택 시 법정동 목록 가져오기 -->
<script>
    function onCityChange() {
        const district = document.getElementById("citySelect").value;
        if (!district) return;

        fetch(`/api/deals/district/${district}/neighborhood`)
            .then(res => res.json())
            .then(data => {
                const neighborhoodSelect = document.getElementById("neighborhoodSelect");
                neighborhoodSelect.innerHTML = '<option value="">법정동 선택</option>';
                data.forEach(neighborhood => {
                    const option = document.createElement('option');
                    option.value = neighborhood;
                    option.textContent = neighborhood;
                    neighborhoodSelect.appendChild(option);
                });
            })
            .catch(error => console.log('법정동 데이터 가져오기 실패', error));
    }
</script>

<script>
    // 거래 금액 치환하기
    function formatDealAmount(amount) {
        if (!amount) return "정보 없음";

        // 쉼표 제거 → 숫자 → 1000 곱함 → 다시 쉼표 포맷 후 원 붙임
        const numeric = parseInt(amount.replace(/,/g, ''));
        if (isNaN(numeric)) return "정보 없음";

        const realAmount = numeric * 1000;
        return realAmount.toLocaleString('ko-KR') + '원';
    }
    function onNeighborhoodChange() {
        const district = document.getElementById("citySelect").value;
        const neighborhood = document.getElementById("neighborhoodSelect").value;
        if (!district || !neighborhood) return;

        fetch(`/api/deals/district/${district}/neighborhood/${neighborhood}`)
            .then(res => res.json())
            .then(data => {
                const outputDiv = document.getElementById("dataOutput");
                outputDiv.innerHTML = "";

                if (data.length === 0) {
                    outputDiv.innerHTML = "<p>거래 내역이 없습니다.</p>";
                    return;
                }

                data.forEach(deal => {
                    const dealBox = document.createElement("div");
                    dealBox.style.border = "1px solid #ccc";
                    dealBox.style.padding = "10px";
                    dealBox.style.marginBottom = "10px";
                    dealBox.innerHTML = `
                    <strong>${deal.aptName || "정보 없음"}</strong><br>
                    날짜: ${deal.dealYear ?? "정보 없음"}-${deal.dealMonth ?? "정보 없음"}-${deal.dealDay ?? "정보 없음"}<br>
                    거래금액: ${formatDealAmount(deal.dealAmount)}<br>
                    시군구: ${deal.district || "정보 없음"}<br>
                    법정동: ${deal.neighborhood || "정보 없음"}<br>
                    주택유형: ${deal.houseType || "정보 없음"}<br>
                    지번: ${deal.jiBun || "정보 없음"}<br>
                    층수: ${deal.floor ?? "정보 없음"}<br>
                    전용면적: ${deal.excluUseAr ?? "정보 없음"} ㎡<br>
                    대지면적: ${deal.plottageArea ?? "정보 없음"} ㎡<br>
                    거래면적: ${deal.dealArea ?? "정보 없음"} ㎡<br>
                    지목: ${deal.jimok || "정보 없음"}<br>
                    용도지역: ${deal.landUse || "정보 없음"}<br>
                    지분유형: ${deal.shareDealingType || "정보 없음"}<br>
                    거래구분: ${deal.dealingGbn || "정보 없음"}<br>
                    자료구분: ${deal.dataType || "정보 없음"}<br>
                `;
                    outputDiv.appendChild(dealBox);
                });
            })
            .catch(err => console.error("거래 내역 로딩 실패", err));
    }
</script>


</body>
</html>
