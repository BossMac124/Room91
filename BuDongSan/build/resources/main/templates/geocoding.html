<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í†µí•© ì§€ë„ ê²€ìƒ‰</title>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=d6d23793f0ca98625a72a1157e4c9fe7&libraries=services"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<h2>ğŸ“ ì£¼ì†Œ ë˜ëŠ” í‚¤ì›Œë“œë¡œ ê²€ìƒ‰</h2>
<input type="text" id="input" placeholder="ì£¼ì†Œë‚˜ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
<button onclick="search()">ê²€ìƒ‰</button>

<div id="result" style="margin-top: 10px;"></div>
<div id="map"></div>

<script>
    let map;
    let geocoder;
    let marker; // ì£¼ì†Œ ê²€ìƒ‰ ë§ˆì»¤
    let placeMarkers = []; // í‚¤ì›Œë“œ ê²€ìƒ‰ ë§ˆì»¤ë“¤

    function initMap() {
        const container = document.getElementById('map');
        const options = {
            center: new kakao.maps.LatLng(37.5665, 126.9780),
            level: 3
        };
        map = new kakao.maps.Map(container, options);
        geocoder = new kakao.maps.services.Geocoder();
    }

    function search() {
        const input = document.getElementById("input").value.trim();
        const resultDiv = document.getElementById("result");

        if (!input) {
            alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        // 1. ì£¼ì†Œ ê²€ìƒ‰ ë¨¼ì € ì‹œë„
        geocoder.addressSearch(input, function (result, status) {
            if (status === kakao.maps.services.Status.OK) {
                const lat = result[0].y;
                const lng = result[0].x;

                resultDiv.innerHTML = `<p>ğŸ“ ì£¼ì†Œë¡œ ê²€ìƒ‰ë¨<br>ìœ„ë„: ${lat}, ê²½ë„: ${lng}</p>`;
                const moveLatLng = new kakao.maps.LatLng(lat, lng);
                map.setCenter(moveLatLng);

                // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                if (marker) marker.setMap(null);
                placeMarkers.forEach(m => m.setMap(null));
                placeMarkers = [];

                // ìƒˆ ë§ˆì»¤ ì¶”ê°€
                marker = new kakao.maps.Marker({
                    map: map,
                    position: moveLatLng,
                    title: input
                });

            } else {
                // 2. ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨ â†’ í‚¤ì›Œë“œ ê²€ìƒ‰ìœ¼ë¡œ fallback
                const ps = new kakao.maps.services.Places();

                // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                if (marker) marker.setMap(null);
                placeMarkers.forEach(m => m.setMap(null));
                placeMarkers = [];

                ps.keywordSearch(input, function (data, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const bounds = new kakao.maps.LatLngBounds();
                        data.forEach(place => {
                            const position = new kakao.maps.LatLng(place.y, place.x);
                            const keywordMarker = new kakao.maps.Marker({
                                map: map,
                                position: position,
                                title: place.place_name
                            });
                            placeMarkers.push(keywordMarker);
                            bounds.extend(position);
                        });
                        map.setBounds(bounds);
                        resultDiv.innerHTML = `ğŸ” <b>${input}</b> í‚¤ì›Œë“œë¡œ ${data.length}ê°œ ê²°ê³¼ í‘œì‹œë¨`;
                    } else {
                        resultDiv.innerHTML = "âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.";
                    }
                });
            }
        });
    }

    window.onload = initMap;
</script>
</body>
</html>
